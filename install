#!/usr/bin/env sh

set -ue

BASE_DIR="$(cd "$(dirname "$0")"; pwd)"
CONFIG="${XDG_CONFIG_HOME:-$HOME/.config}"

copy=""

while [ "$#" -ne 0 ]; do
	case "$1" in
		"-c" | "--copy" ) copy="1"; shift 1;;
		* ) printf "usage: %s [--copy]\n" "$0" >&2; exit 1;;
	esac
done

run() {
	printf "\$ %s\n" "$*"
	"$@"
}

put() {
	parent="$(dirname "$2")"
	if [ "$parent" != "$HOME" ]; then
		run mkdir -p "$parent"
	fi
	if [ -n "$copy" ]; then
		run cp --remove-destination "$BASE_DIR/$1" "$2"
	else
		run ln -sf "$BASE_DIR/$1" "$2"
	fi
}

put "files/tmux.conf" "$HOME/.tmux.conf"
put "files/global.vimrc" "$HOME/.vimrc"
put "files/global.zshrc" "$HOME/.zshrc"

put "files/global.gitconfig" "$CONFIG/git/config"
put "files/global.gitignore" "$CONFIG/git/ignore"
put "files/wezterm.lua" "$CONFIG/wezterm/wezterm.lua"
