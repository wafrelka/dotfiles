#!/usr/bin/env sh

set -ue

BASE_DIR="$(cd "$(dirname "$0")"; pwd)"
CONFIG="${XDG_CONFIG_HOME:-$HOME/.config}"
if [ "$(uname)" = "Darwin" ]; then
	NATIVE_CONFIG="$HOME/Library/Application Support"
else
	NATIVE_CONFIG="$CONFIG"
fi

copy=""

while [ "$#" -ne 0 ]; do
	case "$1" in
		"-c" | "--copy" ) copy="1"; shift 1;;
		* ) printf "usage: %s [--copy]\n" "$(basename "$0")" >&2; exit 1;;
	esac
done

run() {
	printf "\$ %s\n" "$*"
	"$@"
}

put() {
	local src="$BASE_DIR/$1"
	local dest="$2"
	local dest_dir
	dest_dir="$(dirname "$dest")"
	if [ "$dest_dir" != "$HOME" ]; then
		run mkdir -p "$dest_dir"
	fi
	if [ -n "$copy" ]; then
		run cp --remove-destination "$src" "$dest"
	else
		run ln -sf "$src" "$dest"
	fi
}

put "files/tmux.conf" "$HOME/.tmux.conf"
put "files/global.vimrc" "$HOME/.vimrc"
put "files/global.zshrc" "$HOME/.zshrc"

put "files/global.gitconfig" "$CONFIG/git/config"
put "files/global.gitignore" "$CONFIG/git/ignore"
put "files/wezterm.lua" "$CONFIG/wezterm/wezterm.lua"

put "files/k9s.config.yaml" "$NATIVE_CONFIG/k9s/config.yaml"
put "files/k9s.default-skin.yaml" "$NATIVE_CONFIG/k9s/skins/default-skin.yaml"
